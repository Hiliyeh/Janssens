{% comment %}
BreadcrumbList Schema JSON-LD Generator
=======================================
Generates structured data for breadcrumb navigation to enable rich snippets in Google.
Automatically detects the page layout and builds the appropriate breadcrumb structure.

Usage: {% include schema/breadcrumb.html %}
No parameters needed - auto-detects based on page.layout

Supported layouts:
- city: Home > Zones > City
- service: Home > Services > Service
- city-service: Home > Zones > City > Service
- emergency: Home > Urgences > Emergency
- emergency-city: Home > Emergency > City
- brand: Home > Marques > Brand
- guide: Home > Guides > Guide
- guide-index: Home > Guides
{% endcomment %}

{% assign lang = page.lang | default: 'fr' %}
{% assign t = site.data.translations[lang] %}

{% comment %}Define folder names per language{% endcomment %}
{% case lang %}
{% when 'nl' %}
    {% assign services_folder = "diensten" %}
    {% assign cities_folder = "gemeenten" %}
    {% assign guides_folder = "gidsen" %}
    {% assign emergency_folder = "noodgeval" %}
    {% assign brands_folder = "merken" %}
{% when 'en' %}
    {% assign services_folder = "services" %}
    {% assign cities_folder = "cities" %}
    {% assign guides_folder = "guides" %}
    {% assign emergency_folder = "emergency" %}
    {% assign brands_folder = "brands" %}
{% else %}
    {% assign services_folder = "services" %}
    {% assign cities_folder = "communes" %}
    {% assign guides_folder = "guides" %}
    {% assign emergency_folder = "urgence" %}
    {% assign brands_folder = "marques" %}
{% endcase %}

{% comment %}Skip home page - no breadcrumb needed{% endcomment %}
{% if page.layout == 'home' %}
{% else %}

{% comment %}Build breadcrumb items array{% endcomment %}
{% assign bc_items = "" | split: "" %}

{% comment %}Item 1: Always Home{% endcomment %}
{% capture home_item %}{{ t.breadcrumb.home }}|||{{ site.url }}/{{ lang }}/{% endcapture %}
{% assign bc_items = bc_items | push: home_item %}

{% case page.layout %}

{% when 'city' %}
    {% comment %}Home > Zones > City{% endcomment %}
    {% capture zones_item %}{{ t.breadcrumb.cities }}|||{{ site.url }}/{{ lang }}/#zones{% endcapture %}
    {% assign bc_items = bc_items | push: zones_item %}
    {% capture city_item %}{{ page.city_name }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: city_item %}

{% when 'service' %}
    {% comment %}Home > Services > Service{% endcomment %}
    {% for s in site.data.services %}
        {% if s.id == page.service_id %}{% assign service = s %}{% endif %}
    {% endfor %}
    {% capture services_item %}{{ t.breadcrumb.services }}|||{{ site.url }}/{{ lang }}/#services{% endcapture %}
    {% assign bc_items = bc_items | push: services_item %}
    {% capture service_item %}{{ service[lang].title }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: service_item %}

{% when 'city-service' %}
    {% comment %}Home > Zones > City > Service{% endcomment %}
    {% for s in site.data.services %}
        {% if s.id == page.service_id %}{% assign service = s %}{% endif %}
    {% endfor %}
    {% capture zones_item %}{{ t.breadcrumb.cities }}|||{{ site.url }}/{{ lang }}/#zones{% endcapture %}
    {% assign bc_items = bc_items | push: zones_item %}
    {% capture city_item %}{{ page.city_name }}|||{{ site.url }}/{{ lang }}/{{ cities_folder }}/{{ page.city_slug }}/{% endcapture %}
    {% assign bc_items = bc_items | push: city_item %}
    {% capture service_item %}{{ service[lang].name }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: service_item %}

{% when 'emergency' %}
    {% comment %}Home > Urgences > Emergency{% endcomment %}
    {% for e in site.data.emergencies %}
        {% if e.id == page.emergency_id %}{% assign emergency = e %}{% endif %}
    {% endfor %}
    {% capture emergency_cat_item %}{{ t.breadcrumb.emergency }}|||{{ site.url }}/{{ lang }}/#services{% endcapture %}
    {% assign bc_items = bc_items | push: emergency_cat_item %}
    {% capture emergency_item %}{{ emergency[lang].title }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: emergency_item %}

{% when 'emergency-city' %}
    {% comment %}Home > Emergency > City{% endcomment %}
    {% for e in site.data.emergencies %}
        {% if e.id == page.emergency_id %}{% assign emergency = e %}{% endif %}
    {% endfor %}
    {% capture emergency_item %}{{ emergency[lang].name }}|||{{ site.url }}/{{ lang }}/{{ emergency_folder }}/{{ emergency[lang].slug }}/{% endcapture %}
    {% assign bc_items = bc_items | push: emergency_item %}
    {% capture city_item %}{{ page.city_name }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: city_item %}

{% when 'brand' %}
    {% comment %}Home > Marques > Brand{% endcomment %}
    {% for b in site.data.brands %}
        {% if b.id == page.brand_id %}{% assign brand = b %}{% endif %}
    {% endfor %}
    {% capture brands_item %}{{ t.breadcrumb.brands }}|||{{ site.url }}/{{ lang }}/#services{% endcapture %}
    {% assign bc_items = bc_items | push: brands_item %}
    {% capture brand_item %}{{ brand.name }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: brand_item %}

{% when 'brand-city' %}
    {% comment %}Home > Marques > Brand > City{% endcomment %}
    {% for b in site.data.brands %}
        {% if b.id == page.brand_id %}{% assign brand = b %}{% endif %}
    {% endfor %}
    {% capture brands_item %}{{ t.breadcrumb.brands }}|||{{ site.url }}/{{ lang }}/#services{% endcapture %}
    {% assign bc_items = bc_items | push: brands_item %}
    {% capture brand_item %}{{ brand.name }}|||{{ site.url }}/{{ lang }}/{{ brands_folder }}/{{ brand.slug }}/{% endcapture %}
    {% assign bc_items = bc_items | push: brand_item %}
    {% capture city_item %}{{ page.city_name }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: city_item %}

{% when 'guide' %}
    {% comment %}Home > Guides > Guide{% endcomment %}
    {% for g in site.data.guides %}
        {% if g.id == page.guide_id %}{% assign guide = g %}{% endif %}
    {% endfor %}
    {% capture guides_item %}{{ t.breadcrumb.guides }}|||{{ site.url }}/{{ lang }}/{{ guides_folder }}/{% endcapture %}
    {% assign bc_items = bc_items | push: guides_item %}
    {% capture guide_item %}{{ guide[lang].title }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: guide_item %}

{% when 'guide-index' %}
    {% comment %}Home > Guides{% endcomment %}
    {% capture guides_item %}{{ t.breadcrumb.guides }}|||{{ site.url }}{{ page.url }}{% endcapture %}
    {% assign bc_items = bc_items | push: guides_item %}

{% endcase %}

{% if bc_items.size > 1 %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {% for item in bc_items %}
        {% assign parts = item | split: "|||" %}
        {% assign name = parts[0] | escape %}
        {% assign url = parts[1] %}
        {
            "@type": "ListItem",
            "position": {{ forloop.index }},
            "name": "{{ name }}"{% if url != "" and url != blank %},
            "item": "{{ url }}"{% endif %}
        }{% unless forloop.last %},{% endunless %}
        {% endfor %}
    ]
}
</script>
{% endif %}

{% endif %}
